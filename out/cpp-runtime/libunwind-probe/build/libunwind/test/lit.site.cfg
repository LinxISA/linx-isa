#
# Configuration file for running the libunwind tests against the static library.
#

lit_config.load_config(config, '/Users/zhoubot/linx-isa/out/cpp-runtime/libunwind-probe/build/libunwind/test/cmake-bridge.cfg')

compile_flags = []
link_flags = []

if False:
    link_flags.append('-lpthread')

if False:
    compile_flags.append('-fcf-protection=full')

if False:
    compile_flags.append('-mbranch-protection=standard')

# On ELF platforms, link tests with -Wl,--export-dynamic if supported by the linker.
if len('-Wl,--export-dynamic'):
    link_flags.append('-Wl,--export-dynamic')

if 'dl':
    link_flags.append('-ldl')

# Stack unwinding tests need unwinding tables and these are not generated by default on all targets.
compile_flags.append('-funwind-tables')

local_sysroot = '' or '/Users/zhoubot/linx-isa/out/libc/musl/install/phase-b'
config.substitutions.append(('%{flags}',
    '-isysroot {}'.format(local_sysroot) if local_sysroot else ''
))
config.substitutions.append(('%{compile_flags}',
    '-nostdinc++ -I %{{include}} {}'.format(' '.join(compile_flags))
))
config.substitutions.append(('%{link_flags}',
    '%{{lib}}/libunwind.a {}'.format(' '.join(link_flags))
))
config.substitutions.append(('%{exec}',
    '%{executor} --execdir %{temp} -- '
))

import os, site
site.addsitedir(os.path.join('/Users/zhoubot/linx-isa/compiler/llvm/libunwind/../libcxx', 'utils'))
import libcxx.test.params, libcxx.test.config
libcxx.test.config.configure(
    libcxx.test.params.DEFAULT_PARAMETERS,
    libcxx.test.features.DEFAULT_FEATURES,
    config,
    lit_config
)
